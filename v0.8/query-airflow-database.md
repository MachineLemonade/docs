---
title: "Query the Airflow Database"
description: "Guide on how to query Postgres, Airflow's underlying Database, on Astronomer"
date: 2019-06-03T00:00:00.000Z
slug: "query-airflow-database"
---


## Overview

At Astronomer, each Airflow deployment is eqiupped with a PostgreSQL database that serves as Airflow's underlying metadata database and your Airflow scheduler's source of truth.

Astronomer hosts that database for Astronomer Cloud customers (each securely isolated from the rest) and our team helps Enterprise customers get their own set up during our platform installation.

## Access Your Airflow Deployment's Postgres

To successfully leverage Airflow's "Ad Hoc Query" feature (acessible from the Airflow UI), you'll need to confirm access to the database in the first place.

### Local Deployment

When developing locally, you'll need to set up your local Postgres connection.

**1. Add `libstdc++` to `packages.txt`**

Airflow uses Pandas to power the Ad Hoc Query engine, which requires this additional dependency.

`libstdc++` is a top-level Alpine-level package that belongs in `packages.txt`, a file automatically generated upon initializing an Airflow project with Astronomer's CLI.

**2. Find the `airflow_db` Connection Object**

On the Airflow UI, navigate over to `Admin` > `Connections`.

The `airflow_db` connection is generated by default.

![Connections Page](https://assets2.astronomer.io/main/docs/query-postgres/query-postgres-connection-page.png)

**3. Edit the Connection**

In the `airflow_db` connection object, change the Conn Type to Postgres.

From there, add the following connection information:

```
host: postgres
schema: postgres
login: postgres
password: postgres
port (optional): 5432
```

![Connections Details Page](https://assets2.astronomer.io/main/docs/query-postgres/query-postgres-connection-details.png)

The port will be set to 5342 by default but if you’ve set a custom port, you’ll need to update that here as well.

**4. Connect to the DB via a PostgreSQL Client**

With the connection information above, you should be able to connect to the Airflow database from any PostgreSQL client.

### A Remote Deployment

To set up a connection for a remote deployment on Astronomer Cloud or Enterprise, start with Steps 1 + 2 above.

**3. Edit the Connection**

The same way you followed the steps above for a local deployment, add the following connection details to the `airflow_db` connection object:

```
host: {host}-pgbouncer
schema: {host}-metadata
login: {host}_airflow
```

For example, if your deployment name was planetary-magnitude-8405, the connection information would be the following:

```
host: planetary-magnitude-8405-pgbouncer
schema: planetary-magnitude-8405-metadata
login: planetary-magnitude-8405_airflow
```

**4. Access your Postgres Credentials**

Astronomer Cloud: If you're a Cloud customer, reach out to us at support@astronomer.io for your username and password.

Astronomer Enterprise: An individual deployment's Postgres credentials are stored as a Kubernetes Secret, which you can access via kubectl. Instructions here.

